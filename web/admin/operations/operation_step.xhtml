<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:a="http://xmlns.jcp.org/jsf/passthrough"
      xmlns:f="http://java.sun.com/jsf/core">

    <h:head>       

        <title>Sismar - Etapa</title>

        <ui:include src="/admin/components/headdefault.xhtml" /> 

        <style>

            .ui-inputfield{
                display: block !important;
                width: 100% !important; 
                height: 34px !important;
                padding: 6px 12px !important;
                font-size: 14px !important;
                line-height: 1.42857143 !important;
                color: #555 !important;
                background-color: #fff !important;
                background-image: none !important;
                border: 1px solid #ccc !important;
                border-radius: 4px !important;
                box-shadow: inset 0 1px 1px rgba(0,0,0,.075) !important;    
                transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s !important;
            }
            .ui-inputfield:focus{
                border-color: #66afe9 !important;
                outline: 0 !important;    
                box-shadow: inset 0 1px 1px rgba(0,0,0,.075), 0 0 8px rgba(102,175,233,.6) !important;
            }

            .p-datepicker{
                width: 100%;
            }

            .data-vessel-row {
                border-bottom: 1px solid #dedede;
                padding: 10px;
            }

            .data-vessel-row-last {
                padding: 10px;
            }

        </style>

    </h:head>

    <h:body>

        <div class="container-fluid" style="padding: 0px">           

            <ui:include src="/admin/components/menu.xhtml" />
            <ui:include src="/admin/components/header.xhtml" />   

            <div id="content" class="col-xs-12">

                <div id="content-header" class="col-xs-12">
                    <span id="content-title">Etapa: #{OperationStepBean.etapaOperacao.codEtapa.nome}</span> 
                    <span id="content-subtitle">Detalhes</span>                    
                </div>

                <div class="col-xs-12 content-card" style="margin-top: 30px; margin-bottom: 100px;">

                    <div class="row" style="margin-top: 20px; margin-left: 15px; margin-right: 15px; margin-bottom: 15px;">

                        <div class="col-xs-12 col-md-3" style="margin-bottom: 15px;">
                            <img style="border-radius:8px;" 
                                 width="100%"
                                 src="${OperationStepBean.getImageVessel()}"/>
                        </div>

                        <div class="col-xs-12 col-md-9">

                            <div class="row data-vessel-row">
                                <div class="col-xs-12 col-md-3">
                                    <b>IMO</b>
                                </div>
                                <div class="col-xs-12 col-md-9">
                                    #{OperationStepBean.operation.codNavio.imo}
                                </div>
                            </div>

                            <div class="row data-vessel-row">
                                <div class="col-xs-12 col-md-3">
                                    <b>NAVIO</b>
                                </div>
                                <div class="col-xs-12 col-md-9">
                                    #{OperationStepBean.operation.codNavio.nomeNavio}
                                </div>
                            </div>

                            <div class="row data-vessel-row">
                                <div class="col-xs-12 col-md-3">
                                    <b>TIPO</b>
                                </div>
                                <div class="col-xs-12 col-md-9">
                                    #{OperationStepBean.vesselType}
                                </div>
                            </div>

                            <div class="row data-vessel-row-last">
                                <div class="col-xs-12 col-md-3">
                                    <b>DIMENSÃO</b>
                                </div>
                                <div class="col-xs-12 col-md-9">
                                    #{OperationStepBean.vesselDimensao}
                                </div>
                            </div>

                        </div>

                    </div>                  

                    <h:form id="form-acao-etapa">

                        <div class="row" 
                             style="border-top: 2px solid #989898; padding-top: 40px; margin-top: 20px; margin-left: 15px; margin-right: 15px; margin-bottom: 15px;">

                            <div class="col-xs-12 col-md-3" style="margin-bottom: 15px; display: none">                            
                                <iframe 
                                    width="100%" 
                                    frameborder="0" 
                                    scrolling="no" 
                                    marginheight="0" 
                                    marginwidth="0" 
                                    src="#{OperationStepBean.srcMapIframe}"
                                    ></iframe>
                                <font color="blue">Localização de inicio</font>
                            </div>

                            <div style="width: 100%;">
                                <div class="col-xs-12 content-card-header">
                                    <span class="content-card-title" style="margin-bottom: 20px;">Detalhes da etapa</span>                                 
                                </div>                            
                            </div>

                            <div class="col-xs-12 col-md-12">

                                <div class="row data-vessel-row">
                                    <div class="col-xs-12 col-md-3">
                                        <b>ETAPA</b>
                                    </div>
                                    <div class="col-xs-12 col-md-9">
                                        #{OperationStepBean.etapaOperacao.codEtapa.nome}
                                    </div>
                                </div>

                                <div class="row data-vessel-row">
                                    <div class="col-xs-12 col-md-3">
                                        <b>LATITUDE</b>
                                    </div>
                                    <div class="col-xs-12 col-md-9">
                                        #{OperationStepBean.etapaOperacao.latitude}
                                    </div>
                                </div>

                                <div class="row data-vessel-row">
                                    <div class="col-xs-12 col-md-3">
                                        <b>LONGITUDE</b>
                                    </div>
                                    <div class="col-xs-12 col-md-9">
                                        #{OperationStepBean.etapaOperacao.longitude}
                                    </div>
                                </div>

                                <div class="row data-vessel-row">
                                    <div class="col-xs-12 col-md-3">
                                        <b>MOBILIZAÇÃO</b>
                                    </div>
                                    <div class="col-xs-12 col-md-9">
                                        #{UtilBean.getDateTimeClient(OperationStepBean.etapaOperacao.dataMobilizacao)}     
                                    </div>
                                </div>

                                <div class="row data-vessel-row">
                                    <div class="col-xs-12 col-md-3">
                                        <b>CHEGADA</b>
                                    </div>
                                    <div class="col-xs-12 col-md-9">
                                        #{UtilBean.getDateTimeClient(OperationStepBean.etapaOperacao.dataChegada)}     
                                    </div>
                                </div>

                                <div class="row data-vessel-row">
                                    <div class="col-xs-12 col-md-3">
                                        <b>INÍCIO</b>
                                    </div>
                                    <div class="col-xs-12 col-md-9">
                                        #{UtilBean.getDateTimeClient(OperationStepBean.etapaOperacao.dataInicio)}     
                                    </div>
                                </div>

                                <div class="row data-vessel-row">
                                    <div class="col-xs-12 col-md-3">
                                        <b>TÉRMINO</b>
                                    </div>
                                    <div class="col-xs-12 col-md-9">
                                        #{UtilBean.getDateTimeClient(OperationStepBean.etapaOperacao.dataTermino)}
                                    </div>
                                </div>

                                <div class="row data-vessel-row">
                                    <div class="col-xs-12 col-md-3">
                                        <b>TEMPO ESTIMADO</b>
                                    </div>
                                    <div class="col-xs-12 col-md-9">
                                        #{OperationStepBean.getTempoEstimado(OperationStepBean.etapaOperacao)}
                                    </div>
                                </div>

                                <div class="row data-vessel-row">
                                    <div class="col-xs-12 col-md-3">
                                        <b>TÉRMINO ESTIMADO</b>
                                    </div>
                                    <div class="col-xs-12 col-md-9">
                                        #{OperationStepBean.getTerminoEstimado(OperationStepBean.etapaOperacao)}
                                    </div>
                                </div>

                                <div class="row data-vessel-row">
                                    <div class="col-xs-12 col-md-3">
                                        <b>EXECUTADO</b>
                                    </div>
                                    <div class="col-xs-12 col-md-9">                                    
                                        <span style="color: #{OperationStepBean.etapaOperacao.colorDecorridoTime}">
                                            <b>#{OperationStepBean.etapaOperacao.decorridoTime}</b>
                                        </span>
                                        <br/>
                                        <div class="progress" style="width: 150px; height: 10px !important;">
                                            <div class="progress-bar #{OperationStepBean.etapaOperacao.classPctDecorridoTime}" 
                                                 role="progressbar" 
                                                 aria-valuenow="#{OperationStepBean.etapaOperacao.pctDecorridoTime}" 
                                                 aria-valuemin="0" 
                                                 aria-valuemax="100" 
                                                 style="width: #{OperationStepBean.etapaOperacao.pctDecorridoTime}%;">
                                            </div>                                        
                                        </div>
                                    </div>
                                </div>

                                <div class="row data-vessel-row">
                                    <div class="col-xs-12 col-md-3">
                                        <b>TEMPO PARALIZADO</b>
                                    </div>
                                    <div class="col-xs-12 col-md-9">                                    
                                        #{OperationStepBean.etapaOperacao.decorridoTimeParalizacao}
                                    </div>
                                </div>

                                <div class="row data-vessel-row-last">
                                    <div class="col-xs-12 col-md-3">
                                        <b>STATUS</b>
                                    </div>
                                    <div class="col-xs-12 col-md-9" style="display: flex">
                                        <span style="margin-right: 10px; color: #{OperationStepBean.etapaOperacao.colorStatus}">
                                            <b>#{OperationStepBean.etapaOperacao.statusString}</b>
                                        </span>
                                        <c:if test="#{OperationStepBean.etapaOperacao.emAndamento}">
                                            <p:commandLink onclick="PF('dialog-paralizar-etapa').show()"
                                                           class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only"
                                                           style="margin: 0px; padding: 5px; float: none !important;">
                                                Paralizar
                                            </p:commandLink>
                                        </c:if>
                                        <c:if test="#{OperationStepBean.etapaOperacao.paralizado}">
                                            <p:commandLink actionListener="#{OperationStepBean.setInterrupcaoEditar(OperationStepBean.etapaOperacao.interrupcaoAtual)}"
                                                           oncomplete="PF('dialog-continuar-etapa').show()" 
                                                           class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only"
                                                           update="dialog-continuar-etapa"
                                                           style="margin: 0px; padding: 5px; float: none !important;">
                                                Continuar
                                            </p:commandLink>                                                                                
                                        </c:if>
                                    </div>
                                </div>

                            </div>

                        </div>                  

                    </h:form>

                    <div class="row" 
                         style="border-top: 2px solid #989898; padding-top: 40px; margin-top: 20px; margin-left: 15px; margin-right: 15px; margin-bottom: 15px;">

                        <div style="width: 100%;">
                            <div class="col-xs-12 content-card-header">
                                <span class="content-card-title">Paralizações</span>                                 
                            </div>                            
                        </div>

                        <p:dataTable value="#{OperationStepBean.etapaOperacao.interrupcoesList}" 
                                     var="interrupcao"                                         
                                     rows="20"
                                     paginator="true"                                         
                                     rowIndexVar="index"
                                     emptyMessage="Nenhuma interrupção adicionada"
                                     paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                     id="table-list-data">

                            <p:column headerText="Motivo">
                                #{interrupcao.codEvento.nome}
                            </p:column>

                            <p:column headerText="Observações">
                                #{interrupcao.observacao}
                            </p:column>

                            <p:column headerText="Início" style="width:150px; text-align: center">
                                #{UtilBean.getDateTimeClient(interrupcao.dataInicio)}                                    
                            </p:column>

                            <p:column headerText="Término" style="width:150px; text-align: center">
                                #{UtilBean.getDateTimeClient(interrupcao.dataTermino)}                                    
                            </p:column>                           

                            <p:column headerText="Duração" style="width:150px; text-align: center">
                                #{interrupcao.decorridoTime}
                            </p:column>

                            <p:column headerText="" style="width:80px; text-align: center">
                                <p:commandLink actionListener="#{OperationStepBean.setInterrupcaoDeletar(interrupcao)}"
                                               style="color: #f75151; margin-right: 10px;"
                                               oncomplete="PF('confirmationDialogDelete').show()">
                                    <i class="glyphicon glyphicon-trash"></i>
                                </p:commandLink>
                            </p:column>

                        </p:dataTable>

                    </div>                    

                    <div class="row">

                        <div class="form-group">
                            <div class="col-sm-12">
                                <p:commandButton 
                                    value="Voltar"
                                    actionListener="#{OperationStepBean.back}"
                                    class="sismar-bt-primary"
                                    style="margin-right: 10px !important;"/>
                            </div>
                        </div>

                    </div>

                </div>

            </div>

        </div>        

        <!-- DIALOG PARA PARALIZAR ETAPA -->
        <p:dialog widgetVar="dialog-paralizar-etapa" 
                  position="center center"
                  modal="true" 
                  header="Paralizar etapa"
                  draggable="false"
                  id="dialog-paralizar-etapa"
                  resizable="false"
                  appendTo="@(body)">

            <h:form>

                <div class="col-xs-12 col-md-12" id="container-filtrodialog">

                    <div class="container-filtrodialog-group">
                        <div class="container-filtrodialog-label">
                            <h:outputLabel value="Motivo: "/>
                        </div>
                        <div class="container-filtrodialog-input">
                            <h:selectOneMenu class="form-control"
                                             value="#{OperationStepBean.interrupcaoAdicionar.codEvento}"
                                             converter="eventoConverter">  
                                <f:selectItem itemValue="#{null}" itemLabel="Selecione"/> 
                                <f:selectItems value="#{OperationStepBean.eventos}" 
                                               var="obj" 
                                               itemLabel="#{obj.nome}" 
                                               itemValue="#{obj}"/>
                            </h:selectOneMenu>
                        </div>
                    </div>

                    <div class="container-filtrodialog-group">
                        <div class="container-filtrodialog-label">
                            <h:outputLabel value="Observacoes: "/>
                        </div>
                        <div class="container-filtrodialog-input">                           
                            <p:inputTextarea
                                value="#{OperationStepBean.interrupcaoAdicionar.observacao}"
                                rows="6"
                                cols="33"
                                style="height: 60px !important"
                                class="form-control">  
                            </p:inputTextarea>                            
                        </div>
                    </div>

                    <div class="container-filtrodialog-group">
                        <div class="container-filtrodialog-label">
                            <h:outputLabel value="Início: "/>
                        </div>
                        <div class="container-filtrodialog-input">                                                       
                            <h:inputText  
                                a:type="datetime-local" 
                                value="#{OperationStepBean.interrupcaoAdicionar.dataInicio}"
                                class="form-control"
                                converter="dateTimeConverter">  
                            </h:inputText>                                                        
                            <span style="color: blue">Deixe em branco para usar a data/hora atual.</span>
                        </div>
                    </div>

                    <div class="container-filtrodialog-group">
                        <p:commandButton actionListener="#{OperationStepBean.paralizar()}" 
                                         value="Paralizar etapa" 
                                         onclick="PF('statusdialog').show()"
                                         onsuccess="PF('statusdialog').hide()"
                                         onerror="PF('statusdialog').hide()"
                                         class="sismar-bt-primary"
                                         update="form-acao-etapa dialog-continuar-etapa dialog-paralizar-etapa table-list-data"/>

                    </div>

                </div>

            </h:form>

        </p:dialog>

        <!-- DIALOG PARA PARALIZAR ETAPA -->
        <p:dialog widgetVar="dialog-continuar-etapa" 
                  position="center center"
                  modal="true" 
                  header="Continuar etapa"
                  draggable="false"
                  id="dialog-continuar-etapa"
                  resizable="false"
                  appendTo="@(body)">

            <h:form>

                <div class="col-xs-12 col-md-12" id="container-filtrodialog">

                    <div class="container-filtrodialog-group">
                        <div class="container-filtrodialog-label">
                            <h:outputLabel value="Motivo: "/>
                        </div>
                        <div class="container-filtrodialog-input">
                            <h:selectOneMenu class="form-control"
                                             value="#{OperationStepBean.interrupcaoEditar.codEvento}"
                                             converter="eventoConverter"
                                             disabled="true">  
                                <f:selectItem itemValue="#{null}" itemLabel="Selecione"/> 
                                <f:selectItems value="#{OperationStepBean.eventos}" 
                                               var="obj" 
                                               itemLabel="#{obj.nome}" 
                                               itemValue="#{obj}"/>
                            </h:selectOneMenu>
                        </div>
                    </div>

                    <div class="container-filtrodialog-group">
                        <div class="container-filtrodialog-label">
                            <h:outputLabel value="Observacoes: "/>
                        </div>
                        <div class="container-filtrodialog-input">                           
                            <h:inputText  
                                value="#{OperationStepBean.interrupcaoEditar.observacao}"
                                class="form-control"
                                disabled="true">  
                            </h:inputText>                            
                        </div>
                    </div>

                    <div class="container-filtrodialog-group">
                        <div class="container-filtrodialog-label">
                            <h:outputLabel value="Início: "/>
                        </div>
                        <div class="container-filtrodialog-input">                                                       
                            <h:inputText  
                                a:type="datetime-local" 
                                value="#{OperationStepBean.interrupcaoEditar.dataInicio}"
                                class="form-control"
                                converter="dateTimeConverter"
                                disabled="true">  
                            </h:inputText>                                                        
                        </div>
                    </div>

                    <div class="container-filtrodialog-group">
                        <div class="container-filtrodialog-label">
                            <h:outputLabel value="Término "/>
                        </div>
                        <div class="container-filtrodialog-input">                                                       
                            <h:inputText  
                                a:type="datetime-local" 
                                value="#{OperationStepBean.interrupcaoEditar.dataTermino}"
                                class="form-control"
                                converter="dateTimeConverter">  
                            </h:inputText>                                                        
                            <span style="color: blue">Deixe em branco para usar a data/hora atual.</span>
                        </div>
                    </div>

                    <div class="container-filtrodialog-group">
                        <p:commandButton actionListener="#{OperationStepBean.continuar}" 
                                         value="Continuar etapa" 
                                         onclick="PF('statusdialog').show()"
                                         onsuccess="PF('statusdialog').hide()"
                                         onerror="PF('statusdialog').hide()"
                                         class="sismar-bt-primary"
                                         update="form-acao-etapa dialog-continuar-etapa dialog-paralizar-etapa table-list-data"/>
                    </div>

                </div>

            </h:form>

        </p:dialog>

        <p:confirmDialog widgetVar="confirmationDialogDelete" 
                         severity="alert" 
                         message="Deseja realmente excluir a interrupção?" 
                         header="Excluir interrupção" 
                         appendTo="@(body)"
                         id="confirmationDialog">  
            <h:form>                
                <p:commandButton value="Sim" 
                                 actionListener="#{OperationStepBean.deletar}"
                                 onclick="PF('confirmationDialogDelete').hide();PF('statusdialog').show()"
                                 onsuccess="PF('statusdialog').hide()"
                                 onerror="PF('statusdialog').hide()"                                                 
                                 update="form-acao-etapa dialog-continuar-etapa dialog-paralizar-etapa table-list-data"/>
                <p:commandButton value="Não" 
                                 onclick="PF('confirmationDialogDelete').hide()" 
                                 type="button"/>
            </h:form>
        </p:confirmDialog>

        <ui:include src="/admin/components/footer.xhtml" />  
        <h:outputScript name="js/menu.js" target="body"/>        
        <h:outputScript name="js/locale_pt_br.js" target="body"/>        

        <script>

            $(function () {

                $(".menu-operations").addClass("active");
                $(".menu-operations-operations").addClass("active-link");

            });

        </script>

    </h:body>

</html>